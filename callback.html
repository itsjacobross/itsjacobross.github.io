<!DOCTYPE html>
<html>
  <head>
    <title>Callback</title>
  </head>
  <body>
    <h1>Callback</h1>
    <script>
      // Get the authorization code from the query string
      const authCode = new URLSearchParams(window.location.search).get("code");

      // Set the client ID, client secret, and redirect URI
      const clientId = "ef62885734e94239994ff3e7f65e351e";
      const clientSecret = "dd973fab10164f909b43120d2a6f993f";
      const redirectUri = "https://itsjacobross.github.io/callback";

      // Build the POST request data
      const data = {
        grant_type: "authorization_code",
        code: authCode,
        redirect_uri: redirectUri
      };

      // Build the POST request options
      const options = {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
          Authorization: "Basic " + btoa(`${clientId}:${clientSecret}`)
        },
        body: new URLSearchParams(data).toString()
      };

      // Send the POST request to the Spotify token endpoint
      fetch("https://accounts.spotify.com/api/token", options)
        .then(response => response.json())
        .then(data => {
          // Get the access token
          const accessToken = data.access_token;
          //You can use the access token to access the Spotify Web API on behalf of the user.
          //You can also send the access token to your discord bot
          //And you can also save the access token on your device.
        })
        .catch(error => {
          console.error("Error:", error);
        });

        // Send the POST request to the Spotify user data endpoint
        fetch("https://api.spotify.com/v1/me", {
          headers: {
            'Authorization': 'Bearer '+ accessToken
          }
        })
        .then(response => response.json())
        .then(data => {
          console.log("User Data:", data);
          const username = data.id
         });

         fetch("https://www.discspotq.pythonanywhere.com/save_token", {
           method: "POST",
           body: JSON.stringify({
             username: username,
             access_token: accessToken
           }),
           headers: {
             "Content-Type": "application/json"
           }
         })
         .then(response => response.json())
         .then(data => {
           console.log("Success:", data);
         })
         .catch(error => {
           console.error("Error:", error);
         });
    </script>
  </body>
</html>

